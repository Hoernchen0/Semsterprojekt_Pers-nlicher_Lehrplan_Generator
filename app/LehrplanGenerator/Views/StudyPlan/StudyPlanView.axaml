<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:LehrplanGenerator.ViewModels.StudyPlan"
             x:Class="LehrplanGenerator.Views.StudyPlan.StudyPlanView"
             x:DataType="vm:StudyPlanViewModel">

    <UserControl.Styles>
        <Style Selector="Expander">
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
        </Style>
        <Style Selector="Border">
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
        </Style>
    </UserControl.Styles>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>     
            <ColumnDefinition Width="3*"/>   
            <ColumnDefinition Width="*"/>     
        </Grid.ColumnDefinitions>

        <ScrollViewer Grid.Column="1"
                      VerticalScrollBarVisibility="Auto"
                      IsVisible="{Binding !IsLoading}">

            <StackPanel Margin="20" Spacing="10">
                <Grid Margin="0,0,0,15">
                   <TextBlock Text="{Binding Topic, StringFormat='Lehrplan {0}'}"
                               FontSize="24" 
                               FontWeight="Bold" 
                               HorizontalAlignment="Left"/>
                </Grid>

                <ItemsControl ItemsSource="{Binding Days}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>

                    <ItemsControl.ItemTemplate>
                        <DataTemplate x:DataType="vm:DayPlanViewModel">
                            <Expander Margin="0,0,0,5" HorizontalAlignment="Stretch">
                                <Expander.Header>
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <CheckBox IsChecked="{Binding IsDone, Mode=TwoWay}"/>
                                        <TextBlock Text="{Binding DisplayDate}" 
                                                   VerticalAlignment="Center" 
                                                   FontWeight="Bold"/>
                                    </StackPanel>
                                </Expander.Header>

                                <ItemsControl ItemsSource="{Binding Tasks}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate x:DataType="vm:TaskItemViewModel">
                                            <Border Margin="0,0,0,5"
                                                    Padding="5"
                                                    BorderThickness="1"
                                                    BorderBrush="Gray"
                                                    CornerRadius="4"
                                                    HorizontalAlignment="Stretch">
                                                <Grid ColumnDefinitions="Auto,*" ColumnSpacing="8">
                                                  <CheckBox Grid.Column="0"
                                                            IsChecked="{Binding IsDone, Mode=TwoWay}"
                                                            VerticalAlignment="Top"/>

                                                <StackPanel Grid.Column="1">
                                                    <TextBlock Text="{Binding Title}" FontWeight="Bold" TextWrapping="Wrap"/>
                                                    <TextBlock FontStyle="Italic">
                                                        <TextBlock.Text>
                                                            <MultiBinding StringFormat="{}{0} - {1}">
                                                                <Binding Path="StartTime"/>
                                                                <Binding Path="EndTime"/>
                                                            </MultiBinding>
                                                        </TextBlock.Text>
                                                    </TextBlock>

                                               
                                                    <TextBlock Text="{Binding Description}"
                                                               TextWrapping="Wrap"/>
                                                </StackPanel>
                                            </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </Expander>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <TextBlock Text="Kein Lernplan vorhanden. Bitte nutzen Sie den Chat, um einen Plan zu erstellen." 
                           FontStyle="Italic"
                           HorizontalAlignment="Center"
                           Margin="20"
                           IsVisible="{Binding Days.Count, Converter={x:Static ObjectConverters.Equal}, ConverterParameter=0}"/>

            </StackPanel>
        </ScrollViewer>

        <StackPanel Grid.ColumnSpan="3"
                    IsVisible="{Binding IsLoading}" 
                    HorizontalAlignment="Center" 
                    VerticalAlignment="Center" 
                    Spacing="10">
            <TextBlock Text="Lernplan wird geladen..." FontSize="18" HorizontalAlignment="Center"/>
            <ProgressBar IsIndeterminate="True" Width="300"/>
        </StackPanel>

        <StackPanel Grid.ColumnSpan="3"
                    IsVisible="{Binding ErrorMessage, Converter={x:Static ObjectConverters.IsNotNull}}" 
                    HorizontalAlignment="Center" 
                    VerticalAlignment="Center" 
                    Spacing="10"
                    Margin="20">
            <TextBlock Text="Fehler" FontSize="20" FontWeight="Bold" HorizontalAlignment="Center"/>
            <TextBlock Text="{Binding ErrorMessage}" 
                       TextWrapping="Wrap" 
                       HorizontalAlignment="Center"
                       MaxWidth="400"/>
        </StackPanel>

    </Grid>
</UserControl>
