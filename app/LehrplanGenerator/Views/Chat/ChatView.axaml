<UserControl
    x:Class="LehrplanGenerator.Views.Chat.ChatView"
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:models="using:LehrplanGenerator.Models.Chat"
    xmlns:vm="using:LehrplanGenerator.ViewModels.Chat"
    x:DataType="vm:ChatViewModel">

    <Grid Background="{DynamicResource BgPrimary}">

        <!--  ================= EMPTY STATE =================  -->
        <Grid
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            IsVisible="{Binding HasNoMessages}">

            <StackPanel Width="720" Spacing="28">

                <TextBlock
                    FontSize="32"
                    FontWeight="SemiBold"
                    Foreground="{DynamicResource TextPrimary}"
                    Text="Willkommen zurÃ¼ck"
                    TextAlignment="Center" />

                <TextBlock
                    FontSize="15"
                    Foreground="{DynamicResource TextMuted}"
                    Text="Sag mir, wobei ich dir helfen soll."
                    TextAlignment="Center" />

                <Border
                    Padding="14"
                    Background="{DynamicResource BgSecondary}"
                    BorderBrush="{DynamicResource BorderSubtle}"
                    BorderThickness="1"
                    CornerRadius="24">

                    <StackPanel Spacing="8">

                        <!--  INPUT ROW  -->
                        <Grid ColumnDefinitions="Auto,Auto,*,Auto" ColumnSpacing="12">

                            <!--  âž• CREATE PLAN  -->
                            <Button
                                Grid.Column="0"
                                Classes="secondary"
                                Command="{Binding CreateNewPlanCommand}"
                                IsEnabled="{Binding !IsCreatingPlan}"
                                ToolTip.Tip="Erstelle einen Lernplan">
                                <TextBlock Text="âž•" />
                            </Button>

                            <!--  ðŸ“Ž UPLOAD  -->
                            <Button
                                Grid.Column="1"
                                Classes="secondary"
                                Command="{Binding UploadDocumentCommand}"
                                Content="ðŸ“Ž" />

                            <!--  INPUT  -->
                            <TextBox
                                Grid.Column="2"
                                AcceptsReturn="True"
                                Text="{Binding InputText}"
                                Watermark="Stelle eine Frageâ€¦">
                                <TextBox.KeyBindings>
                                    <KeyBinding Command="{Binding SendCommand}" Gesture="Enter" />
                                </TextBox.KeyBindings>
                            </TextBox>

                            <!--  SEND  -->
                            <Button
                                Grid.Column="3"
                                Classes="send"
                                Command="{Binding SendCommand}"
                                Content="â†‘" />
                        </Grid>

                        <!--  ATTACHMENT PREVIEW  -->
                        <Border
                            Padding="8"
                            Background="{DynamicResource BgPrimary}"
                            BorderBrush="{DynamicResource BorderSubtle}"
                            BorderThickness="1"
                            CornerRadius="8"
                            IsVisible="{Binding HasPendingFile}">

                            <DockPanel>

                                <TextBlock
                                    DockPanel.Dock="Left"
                                    Foreground="{DynamicResource TextPrimary}"
                                    Text="{Binding PendingFilePath}"
                                    TextTrimming="CharacterEllipsis" />

                                <!--  âŒ REMOVE  -->
                                <Button
                                    Classes="link"
                                    Command="{Binding ClearAttachmentCommand}"
                                    Content="âœ•"
                                    DockPanel.Dock="Right"
                                    ToolTip.Tip="Datei entfernen" />
                            </DockPanel>
                        </Border>

                    </StackPanel>
                </Border>
            </StackPanel>
        </Grid>

        <!--  ================= CHAT STATE =================  -->
        <Grid IsVisible="{Binding HasMessages}" RowDefinitions="*,Auto">

            <!--  MESSAGES  -->
            <ScrollViewer
                x:Name="ChatScrollViewer"
                Grid.Row="0"
                Margin="0,24,0,120">

                <ItemsControl
                    MaxWidth="760"
                    HorizontalAlignment="Center"
                    ItemsSource="{Binding Messages}">

                    <ItemsControl.ItemTemplate>
                        <DataTemplate x:DataType="models:ChatMessage">
                            <Grid Margin="0,0,0,16">

                                <Border
                                    Padding="14"
                                    HorizontalAlignment="Right"
                                    Background="#E5E7EB"
                                    CornerRadius="16"
                                    IsVisible="{Binding IsUser}">
                                    <TextBlock
                                        Foreground="#020617"
                                        Text="{Binding DisplayedText}"
                                        TextWrapping="Wrap" />
                                </Border>

                                <Border
                                    Padding="14"
                                    HorizontalAlignment="Left"
                                    Background="{DynamicResource BgSecondary}"
                                    BorderBrush="{DynamicResource BorderSubtle}"
                                    BorderThickness="1"
                                    CornerRadius="16"
                                    IsVisible="{Binding IsAi}">
                                    <TextBlock
                                        Foreground="{DynamicResource TextPrimary}"
                                        Text="{Binding DisplayedText}"
                                        TextWrapping="Wrap" />
                                </Border>

                            </Grid>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>

                </ItemsControl>
            </ScrollViewer>

            <!--  BOTTOM INPUT  -->
            <Border
                Grid.Row="1"
                Margin="24"
                Padding="14"
                Background="{DynamicResource BgSecondary}"
                BorderBrush="{DynamicResource BorderSubtle}"
                BorderThickness="1"
                CornerRadius="24">

                <StackPanel Spacing="8">

                    <Grid ColumnDefinitions="Auto,Auto,*,Auto" ColumnSpacing="12">

                        <Button
                            Grid.Column="0"
                            Classes="secondary"
                            Command="{Binding CreateNewPlanCommand}"
                            IsEnabled="{Binding !IsCreatingPlan}"
                            ToolTip.Tip="Erstelle einen Lernplan">
                            <TextBlock Text="âž•" />
                        </Button>

                        <Button
                            Grid.Column="1"
                            Classes="secondary"
                            Command="{Binding UploadDocumentCommand}"
                            Content="ðŸ“Ž" />

                        <TextBox
                            Grid.Column="2"
                            AcceptsReturn="True"
                            Text="{Binding InputText}"
                            Watermark="Nachricht schreibenâ€¦">
                            <TextBox.KeyBindings>
                                <KeyBinding Command="{Binding SendCommand}" Gesture="Enter" />
                            </TextBox.KeyBindings>
                        </TextBox>

                        <Button
                            Grid.Column="3"
                            Classes="send"
                            Command="{Binding SendCommand}"
                            Content="â†‘" />
                    </Grid>

                    <Border
                        Padding="8"
                        Background="{DynamicResource BgPrimary}"
                        BorderBrush="{DynamicResource BorderSubtle}"
                        BorderThickness="1"
                        CornerRadius="8"
                        IsVisible="{Binding HasPendingFile}">

                        <DockPanel>
                            <TextBlock
                                DockPanel.Dock="Left"
                                Foreground="{DynamicResource TextPrimary}"
                                Text="{Binding PendingFilePath}"
                                TextTrimming="CharacterEllipsis" />

                            <Button
                                Classes="link"
                                Command="{Binding ClearAttachmentCommand}"
                                Content="âœ•"
                                DockPanel.Dock="Right"
                                ToolTip.Tip="Datei entfernen" />
                        </DockPanel>
                    </Border>

                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</UserControl>
