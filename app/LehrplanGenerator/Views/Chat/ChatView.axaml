<UserControl
    x:Class="LehrplanGenerator.Views.Chat.ChatView"
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:md="https://github.com/whistyun/Markdown.Avalonia"
    xmlns:models="using:LehrplanGenerator.Models.Chat"
    xmlns:vm="using:LehrplanGenerator.ViewModels.Chat"
    x:DataType="vm:ChatViewModel">

    <Grid Background="{DynamicResource BgPrimary}">

        <!--  ================= DESKTOP (UNVERÄNDERT) =================  -->
        <Grid x:Name="DesktopLayout">

            <!--  EMPTY STATE  -->
            <Grid
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                IsVisible="{Binding HasNoMessages}">

                <StackPanel Width="720" Spacing="28">

                    <TextBlock
                        FontSize="32"
                        FontWeight="SemiBold"
                        Foreground="{DynamicResource TextPrimary}"
                        Text="Willkommen zurück"
                        TextAlignment="Center" />

                    <TextBlock
                        FontSize="15"
                        Foreground="{DynamicResource TextMuted}"
                        Text="Sag mir, wobei ich dir helfen soll."
                        TextAlignment="Center" />

                    <Border
                        Padding="14"
                        Background="{DynamicResource BgSecondary}"
                        BorderBrush="{DynamicResource BorderSubtle}"
                        BorderThickness="1"
                        CornerRadius="24">

                        <Grid ColumnDefinitions="Auto,Auto,*,Auto" ColumnSpacing="12">
                            <Button
                                Grid.Column="0"
                                Classes="secondary"
                                Command="{Binding CreateNewPlanCommand}">
                                <TextBlock
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    FontSize="22"
                                    FontWeight="SemiBold"
                                    Foreground="{DynamicResource TextPrimary}"
                                    Text="+" />
                            </Button>
                            <Button
                                Grid.Column="1"
                                Classes="secondary"
                                Command="{Binding UploadCommand}">
                                <Image
                                    Width="20"
                                    Height="20"
                                    Source="avares://LehrplanGenerator/Assets/Icons/clip.png" />
                            </Button>
                            <TextBox
                                Grid.Column="2"
                                AcceptsReturn="False"
                                Text="{Binding InputText}"
                                Watermark="Stelle eine Frage…">
                                <TextBox.KeyBindings>
                                    <KeyBinding Command="{Binding SendCommand}" Gesture="Enter" />
                                </TextBox.KeyBindings>
                            </TextBox>
                            <Button
                                Grid.Column="3"
                                Classes="send"
                                Command="{Binding SendCommand}"
                                Content="↑" />
                        </Grid>
                    </Border>
                </StackPanel>
            </Grid>

            <!--  CHAT STATE  -->
            <Grid IsVisible="{Binding HasMessages}" RowDefinitions="*,Auto">

                <ScrollViewer
                    x:Name="ChatScrollViewer"
                    Grid.Row="0"
                    Margin="0,24,0,120">
                    <ItemsControl
                        MaxWidth="760"
                        HorizontalAlignment="Center"
                        ItemsSource="{Binding Messages}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate x:DataType="models:ChatMessage">
                                <Grid Margin="0,0,0,16">

                                    <Border
                                        Padding="14"
                                        HorizontalAlignment="Right"
                                        Background="#E5E7EB"
                                        CornerRadius="16"
                                        IsVisible="{Binding IsUser}">
                                        <TextBlock Text="{Binding DisplayedText}" TextWrapping="Wrap" />
                                    </Border>

                                    <Border
                                        Padding="14"
                                        HorizontalAlignment="Left"
                                        Background="{DynamicResource BgSecondary}"
                                        BorderBrush="{DynamicResource BorderSubtle}"
                                        BorderThickness="1"
                                        CornerRadius="16"
                                        IsVisible="{Binding IsAi}">
                                        <md:MarkdownScrollViewer Markdown="{Binding DisplayedText}" />
                                    </Border>

                                    <Border
                                        Padding="12,8"
                                        HorizontalAlignment="Center"
                                        Background="#FEF3C7"
                                        BorderBrush="#FCD34D"
                                        BorderThickness="1"
                                        CornerRadius="12"
                                        IsVisible="{Binding IsSystem}">
                                        <TextBlock
                                            FontSize="13"
                                            Foreground="#92400E"
                                            Text="{Binding DisplayedText}"
                                            TextAlignment="Center"
                                            TextWrapping="Wrap" />
                                    </Border>

                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>

                <Border
                    Grid.Row="1"
                    Margin="24"
                    Padding="14"
                    Background="{DynamicResource BgSecondary}"
                    BorderBrush="{DynamicResource BorderSubtle}"
                    BorderThickness="1"
                    CornerRadius="24">

                    <Grid ColumnDefinitions="Auto,Auto,*,Auto" ColumnSpacing="12">
                        <Button
                            Grid.Column="0"
                            Classes="secondary"
                            Command="{Binding CreateNewPlanCommand}">
                            <TextBlock
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                FontSize="22"
                                FontWeight="SemiBold"
                                Foreground="{DynamicResource TextPrimary}"
                                Text="+" />
                        </Button>
                        <Button
                            Grid.Column="1"
                            Classes="secondary"
                            Command="{Binding UploadCommand}">
                            <Image
                                Width="20"
                                Height="20"
                                Source="avares://LehrplanGenerator/Assets/Icons/clip.png" />
                        </Button>
                        <TextBox
                            Grid.Column="2"
                            AcceptsReturn="True"
                            Text="{Binding InputText}"
                            Watermark="Nachricht schreiben…">
                            <TextBox.KeyBindings>
                                <KeyBinding Command="{Binding SendCommand}" Gesture="Enter" />
                            </TextBox.KeyBindings>
                        </TextBox>
                        <Button
                            Grid.Column="3"
                            Classes="send"
                            Command="{Binding SendCommand}"
                            Content="↑" />
                    </Grid>
                </Border>
            </Grid>
        </Grid>

        <!--  ================= MOBILE LAYOUT =================  -->
        <Grid x:Name="MobileLayout">

            <!--  ================= EMPTY STATE =================  -->
            <Grid
                MaxWidth="380"
                Margin="16"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                IsVisible="{Binding HasNoMessages}">

                <StackPanel Spacing="16">

                    <TextBlock
                        FontSize="22"
                        Text="Wobei kann ich dir helfen?"
                        TextAlignment="Center" />

                    <!--  INPUT  -->
                    <Border
                        Padding="10"
                        Background="{DynamicResource BgSecondary}"
                        BorderBrush="{DynamicResource BorderSubtle}"
                        BorderThickness="1"
                        CornerRadius="20">

                        <Grid ColumnDefinitions="Auto,Auto,*,Auto" ColumnSpacing="6">

                            <Button
                                Grid.Column="0"
                                Classes="secondary"
                                Command="{Binding CreateNewPlanCommand}"
                                Focusable="False">
                                <TextBlock FontSize="22" Text="+" />
                            </Button>

                            <Button
                                Grid.Column="1"
                                Classes="secondary"
                                Command="{Binding UploadCommand}"
                                Focusable="False">
                                <Image
                                    Width="20"
                                    Height="20"
                                    Source="avares://LehrplanGenerator/Assets/Icons/clip.png" />
                            </Button>

                            <TextBox
                                Grid.Column="2"
                                MinHeight="40"
                                AcceptsReturn="False"
                                Text="{Binding InputText}"
                                Watermark="Stelle eine Frage…" />

                            <Button
                                Grid.Column="3"
                                Classes="send"
                                Command="{Binding SendCommand}"
                                Content="↑"
                                Focusable="False" />
                        </Grid>
                    </Border>
                </StackPanel>
            </Grid>

            <!--  ================= CHAT STATE =================  -->
            <Grid IsVisible="{Binding HasMessages}" RowDefinitions="*,Auto">

                <!--  ================= MESSAGES =================  -->
                <ScrollViewer
                    x:Name="MobileScroll"
                    Grid.Row="0"
                    Padding="12"
                    VerticalScrollBarVisibility="Auto">

                    <StackPanel Spacing="12">

                        <ItemsControl ItemsSource="{Binding Messages}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate x:DataType="models:ChatMessage">
                                    <Grid>

                                        <!--  USER  -->
                                        <Border
                                            Margin="48,0,12,0"
                                            Padding="14"
                                            HorizontalAlignment="Right"
                                            Background="#E5E7EB"
                                            CornerRadius="16"
                                            IsVisible="{Binding IsUser}">
                                            <TextBlock
                                                Foreground="#020617"
                                                Text="{Binding DisplayedText}"
                                                TextWrapping="Wrap" />
                                        </Border>

                                        <!--  AI  -->
                                        <Border
                                            Padding="14"
                                            HorizontalAlignment="Left"
                                            Background="{DynamicResource BgSecondary}"
                                            BorderBrush="{DynamicResource BorderSubtle}"
                                            BorderThickness="1"
                                            CornerRadius="16"
                                            IsVisible="{Binding IsAi}">
                                            <md:MarkdownScrollViewer Markdown="{Binding DisplayedText}" />
                                        </Border>

                                    </Grid>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>

                        <!--  WICHTIGER SPACER  -->
                        <!--  Input (~72) + Taskleiste (~88) + Luft  -->
                        <Border Height="96" />

                    </StackPanel>
                </ScrollViewer>

                <!--  ================= INPUT FIXIERT =================  -->
                <Border
                    x:Name="MobileInput"
                    Grid.Row="1"
                    MaxWidth="380"
                    Margin="12,8,12,88"
                    Padding="10"
                    HorizontalAlignment="Center"
                    Background="{DynamicResource BgSecondary}"
                    BorderBrush="{DynamicResource BorderSubtle}"
                    BorderThickness="1"
                    CornerRadius="20">

                    <Grid ColumnDefinitions="Auto,Auto,*,Auto" ColumnSpacing="6">

                        <Button
                            Grid.Column="0"
                            Classes="secondary"
                            Command="{Binding CreateNewPlanCommand}"
                            Focusable="False">
                            <TextBlock FontSize="22" Text="+" />
                        </Button>

                        <Button
                            Grid.Column="1"
                            Classes="secondary"
                            Command="{Binding UploadCommand}"
                            Focusable="False">
                            <Image
                                Width="20"
                                Height="20"
                                Source="avares://LehrplanGenerator/Assets/Icons/clip.png" />
                        </Button>

                        <TextBox
                            Grid.Column="2"
                            MinHeight="40"
                            AcceptsReturn="False"
                            Text="{Binding InputText}"
                            Watermark="Nachricht schreiben…" />

                        <Button
                            Grid.Column="3"
                            Classes="send"
                            Command="{Binding SendCommand}"
                            Content="↑"
                            Focusable="False" />
                    </Grid>
                </Border>
            </Grid>
        </Grid>


    </Grid>
</UserControl>
